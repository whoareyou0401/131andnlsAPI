!function(e){"use strict";setupCSRF();var i="/api/v1.1/recommendorder/customer/"+window.customer_id+"/cart";Vue.filter("toFixed",function(e,i){return Number(Number(e).toFixed(i))});var t=(new Vue({el:"header",beforeCreate:function(){var e=getCookie("user_role");this.isSalesman="salesman"===e},data:{addGifts:""},methods:{back:function(){window.location.href="/recommendorder/salesman/customer-status"},addGift:function(){window.location.href="/recommendorder/customer/"+window.customer_id+"/add-gift"}}}),new Vue({el:"#cart-items",beforeCreate:function(){var e=getCookie("user_role");this.isSalesman="salesman"===e},data:{dealers:[],insufficient_items:[],bus_hr_from:"",bus_hr_to:"",sum:0,isShowBlank:!1,isShowPlaceorderCell:!0,isShowCon:!0,recommendUrl:"/recommendorder/customer/"+window.customer_id+"/recommend",customerProfile:"/recommendorder/customer/"+window.customer_id+"/profile",dealerListUrl:"/recommendorder/customer/"+window.customer_id+"/dealer-list"},watch:{sum:function(e,i){e>0?$("#placeorder").css("background","#ff4a0c"):0===e&&$("#placeorder").css("background","#dbdbdb")}},methods:{change:function(e){console.log(e),e.original_price=Number(Number(e.original_price).toFixed(2)),r.items=e,r.id=e.id,console.log(r.items),r.price_id=0,r.originalactive=!0,$(".change_price_priceo li").removeClass("active"),r.changprice=!0},addpricemargin:function(e){for(var i in e.items)for(var t in e.items[i].items){for(var s in e.items[i].items[t].item_prices)e.items[i].items[t].item_prices[s].price=Number(Number(e.items[i].items[t].original_price).toFixed(2))+Number(Number(e.items[i].items[t].item_prices[s].price).toFixed(2));if(e.items[i].items[t].id==r.id){e.items[i].items[t].original_price=Number(Number(e.items[i].items[t].original_price).toFixed(2)),r.items=e.items[i].items[t];break}}return e},init:function(){var e=this;$.ajax({url:i,type:"get",success:function(i){e.dealers=e.addpricemargin(i).items,e.sum=i.sum,0===e.dealers.length?(e.isShowBlank=!0,e.isShowPlaceorderCell=!1,e.isShowCon=!1):(e.isShowBlank=!1,e.isShowPlaceorderCell=!0,e.isShowCon=!0),e.sum>0?$("#placeorder").css("background","#ff4a0c"):0===e.sum&&$("#placeorder").css("background","#dbdbdb")}})},add:function(e,i){var t=this,r={};r[e.item_id]=i;var s=e.is_giveaway?"/api/v1.1/recommendorder/customer/"+window.customer_id+"/giveaway":"/api/v1.1/recommendorder/customer/"+window.customer_id+"/cart";$.ajax({url:s,type:"put",data:r,success:function(e){t.init()}})},set:function(e,i){var t=this,r={};r[i.item_id]=event.target.value,console.log(i.is_giveaway);var s=i.is_giveaway?"/api/v1.1/recommendorder/customer/"+window.customer_id+"/giveaway":"/api/v1.1/recommendorder/customer/"+window.customer_id+"/cart";$.ajax({url:s,type:"post",data:r,success:function(e){t.init()}})},dAllSelected:function(e){for(var i=0;i<this.dealers.length;i++)if(this.dealers[i].id===e||void 0===e)for(var t=0;t<this.dealers[i].items.length;t++)if(this.dealers[i].items[t].selected===!1)return!1;return!0},dSelectAll:function(e,t){var r=this,s={};s.items=[];var o,c,a=!0;for(o=0;o<this.dealers.length;o++)if(this.dealers[o].id===t||void 0===t)for(c=0;c<this.dealers[o].items.length;c++)if(this.dealers[o].items[c].selected===!1){a=!1;break}for(o=0;o<this.dealers.length;o++)if(this.dealers[o].id===t||void 0===t)for(c=0;c<this.dealers[o].items.length;c++)this.dealers[o].items[c].selected===a&&s.items.push(this.dealers[o].items[c].item_id);$.ajax({url:i,type:"patch",data:s,success:function(e){r.init()}})},select:function(e,t){var r=this,s={};s.items=[t],$.ajax({url:i,type:"patch",data:s,success:function(e){r.init()}})},sendChecked:function(e,i){return{send_no:e>i,send_checked:e<=i}},dhref:function(e){return"/recommendorder/dealer/"+e+"/customer/"+window.customer_id+"/add-item"},confirmOrder:function(){var e=this;if(0!==this.dealers.length&&0!==e.sum){for(var i=0;i<this.dealers.length;i++){if(this.dealers[i].amount<this.dealers[i].initial_price&&0!==this.dealers[i].amount)return void alert("在"+this.dealers[i].name+"的订单未达到起送金额!");var t=new Date,r=t.getMinutes()+60*t.getHours(),s=this.dealers[i].bus_hr_from,o=this.dealers[i].bus_hr_to;if(null!==s&&null!==o&&0!==this.dealers[i].amount){if(s<o&&(r<s||r>o))return void alert("每日"+intPad(Math.floor(o/60),2)+":"+intPad(o%60,2)+" ~ 次日"+intPad(Math.floor(s/60),2)+":"+intPad(s%60,2)+this.dealers[i].name+"下单系统升级， 不能提供网购下单服务，敬请谅解 ");if(s>o&&r>o&&r<s)return void alert("每日"+intPad(Math.floor(o/60),2)+":"+intPad(o%60,2)+" ~ "+intPad(Math.floor(s/60),2)+":"+intPad(s%60,2)+this.dealers[i].name+"下单系统升级， 不能提供网购下单服务，敬请谅解 ")}}$.ajax({url:"/api/v1.1/recommendorder/customer/"+window.customer_id+"/check-cart",type:"get",success:function(i){return i.items.length>0?(e.insufficient_items=i.items,$(".del-understock-model").show(),void $("footer").addClass("gs-blur")):void(window.location.href="/recommendorder/customer/"+window.customer_id+"/confirm-order")}})}},giveawayIconSrc:function(e){return"/static/images/recommendorder/full_"+Number(e).toFixed(0)+".png"},closeDeleteInsItems:function(){$("footer").removeClass("gs-blur"),$(".del-understock-model").hide()},clearUnderstock:function(){var e=this;$("footer").removeClass("gs-blur"),$(".del-understock-model").hide();var t,r,s={items:[]};for(t=0;t<this.insufficient_items.length;t++)for(r=0;r<this.insufficient_items[t].items.length;r++)s.items.push(this.insufficient_items[t].items[r].id);$.ajax({url:i,type:"delete",data:s,success:function(i){$(".understock-model").show(),setTimeout(function(){$(".understock-model").hide()},1e3),e.init()}})},addProduct:function(){window.location.href="/recommendorder/customer/"+window.customer_id+"/dealer-list"}}})),r=new Vue({el:"#change_price",data:{items:{},prices:[],val:"",id:"",price_id:0,timeOutEvent:0,changprice:!1,close:!1,originalactive:!1,haveprice:!1},methods:{addprice:function(e){var i=this;for(var r in i.items.item_prices){if(i.val==i.items.item_prices[r].price){i.haveprice=!0;break}i.haveprice=!1}""!==i.val&&i.haveprice===!1&&$.ajax({url:"/api/v1.2/recommendorder/customer/"+window.customer_id+"/item-price",type:"put",data:{item_id:i.items.item_id,price:Number(i.val)-Number(e)},success:function(e){t.init(),t.change(i.items),i.val=""}})},changeclose:function(){var e=this;e.changprice=!1,e.haveprice=!1,r.close=!1},disclose:function(){var e=this;e.close=!1},delprice:function(e){var i=this,r=e;$.ajax({url:"/api/v1.2/recommendorder/customer/"+window.customer_id+"/item-price",type:"DELETE",data:{price_id:r,cart_item_id:i.id},success:function(e){t.init(),t.change(i.items)}})},okprice:function(e,i){var t=this;t.close===!1&&(t.price_id=i,$(e.currentTarget).addClass("active"),$(e.currentTarget).siblings().removeClass("active"),t.originalactive=!1,t.haveprice=!1)},gtouchstart:function(){var e=this;e.timeOutEvent=setTimeout(function(){e.close=!0,e.price_id=0},500)},originalprice:function(){var e=this;e.price_id=0,e.originalactive=!0,$(".change_price_priceo li").removeClass("active")},gtouchend:function(){var e=this;clearTimeout(e.timeOutEvent)},commit:function(){var e=this;0===e.price_id?$.ajax({url:"/api/v1.2/recommendorder/customer/"+window.customer_id+"/item-price",type:"post",data:{original_price:1,cart_item_id:e.id},success:function(i){t.init(),t.change(e.items),e.changprice=!1,e.haveprice=!1,e.val=""}}):$.ajax({url:"/api/v1.2/recommendorder/customer/"+window.customer_id+"/item-price",type:"post",data:{price_id:e.price_id,cart_item_id:e.id},success:function(i){t.init(),t.change(e.items),e.changprice=!1,e.haveprice=!1,e.val=""}})}},mounted:function(){}});t.init()}(window.cmApp=window.cmApp||{});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlY29tbWVuZG9yZGVyL2NhcnQuanMiXSwibmFtZXMiOlsiY21BcHAiLCJzZXR1cENTUkYiLCJ1cmwiLCJ3aW5kb3ciLCJjdXN0b21lcl9pZCIsIlZ1ZSIsImZpbHRlciIsIm51bSIsInByZWNpc2lvbiIsIk51bWJlciIsInRvRml4ZWQiLCJiaW5kIiwiZWwiLCJiZWZvcmVDcmVhdGUiLCJ1c2VyX3JvbGUiLCJnZXRDb29raWUiLCJ0aGlzIiwiaXNTYWxlc21hbiIsImRhdGEiLCJhZGRHaWZ0cyIsIm1ldGhvZHMiLCJiYWNrIiwibG9jYXRpb24iLCJocmVmIiwiYWRkR2lmdCIsImRlYWxlcnMiLCJpbnN1ZmZpY2llbnRfaXRlbXMiLCJidXNfaHJfZnJvbSIsImJ1c19ocl90byIsInN1bSIsImlzU2hvd0JsYW5rIiwiaXNTaG93UGxhY2VvcmRlckNlbGwiLCJpc1Nob3dDb24iLCJyZWNvbW1lbmRVcmwiLCJjdXN0b21lclByb2ZpbGUiLCJkZWFsZXJMaXN0VXJsIiwid2F0Y2giLCJuZXdfdmFsdWUiLCJvbGRfdmFsdWUiLCIkIiwiY3NzIiwiY2hhbmdlIiwiaXQiLCJjb25zb2xlIiwibG9nIiwib3JpZ2luYWxfcHJpY2UiLCJjaGFuZ2VwcmljZSIsIml0ZW1zIiwiaWQiLCJwcmljZV9pZCIsIm9yaWdpbmFsYWN0aXZlIiwicmVtb3ZlQ2xhc3MiLCJjaGFuZ3ByaWNlIiwiYWRkcHJpY2VtYXJnaW4iLCJpIiwicSIsInQiLCJpdGVtX3ByaWNlcyIsInByaWNlIiwiaW5pdCIsIl90aGlzIiwiYWpheCIsInR5cGUiLCJzdWNjZXNzIiwibGVuZ3RoIiwiYWRkIiwiaXRlbSIsImRhdGFUb1NlbmQiLCJpdGVtX2lkIiwiX3VybCIsImlzX2dpdmVhd2F5Iiwic2V0IiwiJGV2ZW50IiwiZXZlbnQiLCJ0YXJnZXQiLCJ2YWx1ZSIsImRBbGxTZWxlY3RlZCIsImRpZCIsInVuZGVmaW5lZCIsImoiLCJzZWxlY3RlZCIsImRTZWxlY3RBbGwiLCJjdXJyZW50IiwicHVzaCIsInNlbGVjdCIsInNlbmRDaGVja2VkIiwiaW5pdGlhbF9wcmljZSIsImFtb3VudCIsInNlbmRfbm8iLCJzZW5kX2NoZWNrZWQiLCJkaHJlZiIsImNvbmZpcm1PcmRlciIsImFsZXJ0IiwibmFtZSIsImQiLCJEYXRlIiwibWluX29mX2RheSIsImdldE1pbnV0ZXMiLCJnZXRIb3VycyIsImZyb20iLCJ0byIsImludFBhZCIsIk1hdGgiLCJmbG9vciIsInNob3ciLCJhZGRDbGFzcyIsImdpdmVhd2F5SWNvblNyYyIsImNsb3NlRGVsZXRlSW5zSXRlbXMiLCJoaWRlIiwiY2xlYXJVbmRlcnN0b2NrIiwic2V0VGltZW91dCIsImFkZFByb2R1Y3QiLCJwcmljZXMiLCJ2YWwiLCJ0aW1lT3V0RXZlbnQiLCJjbG9zZSIsImhhdmVwcmljZSIsImFkZHByaWNlIiwib3JpZ3ByaWNlIiwiY2hhbmdlY2xvc2UiLCJkaXNjbG9zZSIsImRlbHByaWNlIiwiY2FydF9pdGVtX2lkIiwib2twcmljZSIsImUiLCJjdXJyZW50VGFyZ2V0Iiwic2libGluZ3MiLCJndG91Y2hzdGFydCIsIm9yaWdpbmFscHJpY2UiLCJndG91Y2hlbmQiLCJjbGVhclRpbWVvdXQiLCJjb21taXQiLCJtb3VudGVkIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQUNOLFlBQ0FDLFlBQ0EsSUFBSUMsR0FBTSxxQ0FBdUNDLE9BQU9DLFlBQWMsT0FDdEVDLEtBQUlDLE9BQU8sVUFBVyxTQUFVQyxFQUFLQyxHQUNqQyxNQUFPQyxRQUFPQSxPQUFPRixHQUFLRyxRQUFRRixLQUV0QyxJQWtCSUcsSUFsQlksR0FBSU4sTUFDaEJPLEdBQUksU0FDSkMsYUFBYyxXQUNWLEdBQUlDLEdBQVlDLFVBQVUsWUFDMUJDLE1BQUtDLFdBQTJCLGFBQWRILEdBRXRCSSxNQUNJQyxTQUFVLElBRWRDLFNBQ0lDLEtBQU0sV0FDRmxCLE9BQU9tQixTQUFTQyxLQUFPLDRDQUUzQkMsUUFBUyxXQUNMckIsT0FBT21CLFNBQVNDLEtBQU8sNEJBQThCcEIsT0FBT0MsWUFBYyxn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LEVBQU1YLFNBQVMsR0FFZCxNQUVMK0UsY0FBYyxXQUNWLEdBQUlwRSxHQUFRNUMsSUFDWjRDLEdBQU1YLFNBQVMsRUFFZFcsRUFBTVYsZ0JBQWUsRUFDdEJYLEVBQUUsMkJBQTJCWSxZQUFZLFdBRTdDOEUsVUFBVSxXQUNOLEdBQUlyRSxHQUFRNUMsSUFDWmtILGNBQWF0RSxFQUFNc0QsZUFFdkJpQixPQUFPLFdBQ0gsR0FBSXZFLEdBQVE1QyxJQUNVLEtBQWpCNEMsRUFBTVgsU0FDUFYsRUFBRXNCLE1BQ0UzRCxJQUFLLHFDQUFxQ0MsT0FBT0MsWUFBWSxjQUM3RDBELEtBQU0sT0FDTjVDLE1BQ0kyQixlQUFpQixFQUNqQjZFLGFBQWU5RCxFQUFNWixJQUV6QmUsUUFBUyxTQUFTN0MsR0FDZFAsRUFBS2dELE9BQ0xoRCxFQUFLOEIsT0FBT21CLEVBQU1iLE9BRWxCYSxFQUFNUixZQUFXLEVBQ2pCUSxFQUFNd0QsV0FBVSxFQUNmeEQsRUFBTXFELElBQUksTUFJbkIxRSxFQUFFc0IsTUFDRTNELElBQUsscUNBQXFDQyxPQUFPQyxZQUFZLGNBQzdEMEQsS0FBTSxPQUNONUMsTUFDSStCLFNBQVdXLEVBQU1YLFNBQ2pCeUUsYUFBZTlELEVBQU1aLElBRXpCZSxRQUFTLFNBQVM3QyxHQUNkUCxFQUFLZ0QsT0FDTGhELEVBQUs4QixPQUFPbUIsRUFBTWIsT0FFbEJhLEVBQU1SLFlBQVcsRUFDakJRLEVBQU13RCxXQUFVLEVBQ2Z4RCxFQUFNcUQsSUFBSSxRQU0vQm1CLFFBQVEsY0FHaEJ6SCxHQUFLZ0QsUUFDRnhELE9BQU9ILE1BQVFHLE9BQU9IIiwiZmlsZSI6InJlY29tbWVuZG9yZGVyL2NhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oY21BcHApIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgc2V0dXBDU1JGKCk7XG4gICAgdmFyIHVybCA9ICcvYXBpL3YxLjEvcmVjb21tZW5kb3JkZXIvY3VzdG9tZXIvJyArIHdpbmRvdy5jdXN0b21lcl9pZCArICcvY2FydCc7XG4gICAgVnVlLmZpbHRlcigndG9GaXhlZCcsIGZ1bmN0aW9uIChudW0sIHByZWNpc2lvbikge1xuICAgICAgICByZXR1cm4gTnVtYmVyKE51bWJlcihudW0pLnRvRml4ZWQocHJlY2lzaW9uKSk7XG4gICAgfSk7XG4gICAgdmFyIGhlYWRlclZ1ZSA9IG5ldyBWdWUoe1xuICAgICAgICBlbDogXCJoZWFkZXJcIixcbiAgICAgICAgYmVmb3JlQ3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHVzZXJfcm9sZSA9IGdldENvb2tpZSgndXNlcl9yb2xlJyk7XG4gICAgICAgICAgICB0aGlzLmlzU2FsZXNtYW4gPSB1c2VyX3JvbGUgPT09IFwic2FsZXNtYW5cIjtcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgYWRkR2lmdHM6IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kczoge1xuICAgICAgICAgICAgYmFjazogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL3JlY29tbWVuZG9yZGVyL3NhbGVzbWFuL2N1c3RvbWVyLXN0YXR1c1wiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZEdpZnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIiArIHdpbmRvdy5jdXN0b21lcl9pZCArIFwiL2FkZC1naWZ0XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgYmluZCA9IG5ldyBWdWUoe1xuICAgICAgICBlbDogJyNjYXJ0LWl0ZW1zJyxcbiAgICAgICAgIGJlZm9yZUNyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB1c2VyX3JvbGUgPSBnZXRDb29raWUoJ3VzZXJfcm9sZScpO1xuICAgICAgICAgICAgdGhpcy5pc1NhbGVzbWFuID0gdXNlcl9yb2xlID09PSBcInNhbGVzbWFuXCI7XG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGRlYWxlcnM6IFtdLFxuICAgICAgICAgICAgaW5zdWZmaWNpZW50X2l0ZW1zOiBbXSxcbiAgICAgICAgICAgIGJ1c19ocl9mcm9tOiBcIlwiLFxuICAgICAgICAgICAgYnVzX2hyX3RvOiBcIlwiLFxuICAgICAgICAgICAgc3VtOiAwLFxuICAgICAgICAgICAgaXNTaG93Qmxhbms6ZmFsc2UsXG4gICAgICAgICAgICBpc1Nob3dQbGFjZW9yZGVyQ2VsbDp0cnVlLFxuICAgICAgICAgICAgaXNTaG93Q29uOnRydWUsXG4gICAgICAgICAgICByZWNvbW1lbmRVcmw6IFwiL3JlY29tbWVuZG9yZGVyL2N1c3RvbWVyL1wiICsgd2luZG93LmN1c3RvbWVyX2lkICsgXCIvcmVjb21tZW5kXCIsXG4gICAgICAgICAgICBjdXN0b21lclByb2ZpbGU6IFwiL3JlY29tbWVuZG9yZGVyL2N1c3RvbWVyL1wiICsgd2luZG93LmN1c3RvbWVyX2lkICsgXCIvcHJvZmlsZVwiLFxuICAgICAgICAgICAgZGVhbGVyTGlzdFVybCA6IFwiL3JlY29tbWVuZG9yZGVyL2N1c3RvbWVyL1wiICsgd2luZG93LmN1c3RvbWVyX2lkICsgXCIvZGVhbGVyLWxpc3RcIixcbiAgICAgICAgfSxcbiAgICAgICAgd2F0Y2g6IHtcbiAgICAgICAgICAgIHN1bTogZnVuY3Rpb24obmV3X3ZhbHVlLG9sZF92YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdfdmFsdWUgPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjcGxhY2VvcmRlcicpLmNzcygnYmFja2dyb3VuZCcsJyNmZjRhMGMnKTtcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihuZXdfdmFsdWUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BsYWNlb3JkZXInKS5jc3MoJ2JhY2tncm91bmQnLCcjZGJkYmRiJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBtZXRob2RzOiB7XG4gICAgICAgICAgICBjaGFuZ2U6ZnVuY3Rpb24oaXQpe1xuICAgICAgICAgICAgICAgIC8vIGlmIChOdW1iZXIoZSk9PXBhcnNlSW50KGUpKSB7XG4vLyBpdGVtLm9yaWdpbmFsX3ByaWNlLGl0ZW0uaXRlbV9wcmljZXMsaXRlbS5pdGVtX2lkXG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIC8vIGNoYW5nZXByaWNlLml0ZW1zPWl0ZW07XG4gICAgICAgICAgICAgICAgLy8gY2hhbmdlcHJpY2UucHJpY2VzPWl0ZW0uaXRlbV9wcmljZXM7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaXQpO1xuICAgICAgICAgICAgICAgIGl0Lm9yaWdpbmFsX3ByaWNlID0gTnVtYmVyKE51bWJlcihpdC5vcmlnaW5hbF9wcmljZSkudG9GaXhlZCgyKSk7XG4gICAgICAgICAgICAgICAgY2hhbmdlcHJpY2UuaXRlbXM9aXQ7XG4gICAgICAgICAgICAgICAgY2hhbmdlcHJpY2UuaWQ9aXQuaWQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbmdlcHJpY2UuaXRlbXMpO1xuICAgICAgICAgICAgICAgIGNoYW5nZXByaWNlLnByaWNlX2lkPTA7XG4gICAgICAgICAgICAgICAgLy8gJChcIi5jaGFuZ2VfcHJpY2Vfb3duXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIGNoYW5nZXByaWNlLm9yaWdpbmFsYWN0aXZlPXRydWU7XG4gICAgICAgICAgICAgICAgJChcIi5jaGFuZ2VfcHJpY2VfcHJpY2VvIGxpXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIC8vICQoXCIjY2hhbmdlX3ByaWNlXCIpLmNzcygnZGlzcGxheScsJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgY2hhbmdlcHJpY2UuY2hhbmdwcmljZT10cnVlO1xuICAgICAgICAgICAgICAgIC8vICQoXCIuY2hhbmdlX3ByaWNlX293blwiKS5odG1sKFwiwqVcIithK1wiJm5ic3Ao5Y6f5Lu3KVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRwcmljZW1hcmdpbjpmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsGNoYW5nZXByaWNl57uE5Lu2aXRlbXPmlbDmja5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YS5pdGVtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHEgaW4gZGF0YS5pdGVtc1tpXS5pdGVtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgdCBpbiBkYXRhLml0ZW1zW2ldLml0ZW1zW3FdLml0ZW1fcHJpY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5pdGVtc1tpXS5pdGVtc1txXS5pdGVtX3ByaWNlc1t0XS5wcmljZSA9IE51bWJlcihOdW1iZXIoZGF0YS5pdGVtc1tpXS5pdGVtc1txXS5vcmlnaW5hbF9wcmljZSkudG9GaXhlZCgyKSkrTnVtYmVyKE51bWJlcihkYXRhLml0ZW1zW2ldLml0ZW1zW3FdLml0ZW1fcHJpY2VzW3RdLnByaWNlKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLml0ZW1zW2ldLml0ZW1zW3FdLmlkPT1jaGFuZ2VwcmljZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLml0ZW1zW2ldLml0ZW1zW3FdLm9yaWdpbmFsX3ByaWNlID0gTnVtYmVyKE51bWJlcihkYXRhLml0ZW1zW2ldLml0ZW1zW3FdLm9yaWdpbmFsX3ByaWNlKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlcHJpY2UuaXRlbXM9ZGF0YS5pdGVtc1tpXS5pdGVtc1txXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kZWFsZXJzID1fdGhpcy5hZGRwcmljZW1hcmdpbihkYXRhKS5pdGVtcztcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnN1bSA9IGRhdGEuc3VtO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuZGVhbGVycy5sZW5ndGggPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmlzU2hvd0JsYW5rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pc1Nob3dQbGFjZW9yZGVyQ2VsbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmlzU2hvd0NvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNTaG93QmxhbmsgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pc1Nob3dQbGFjZW9yZGVyQ2VsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNTaG93Q29uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdW0gPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwbGFjZW9yZGVyJykuY3NzKCdiYWNrZ3JvdW5kJywnI2ZmNGEwYycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoX3RoaXMuc3VtID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BsYWNlb3JkZXInKS5jc3MoJ2JhY2tncm91bmQnLCcjZGJkYmRiJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGl0ZW0sIG51bSl7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgZGF0YVRvU2VuZCA9IHt9O1xuICAgICAgICAgICAgICAgIGRhdGFUb1NlbmRbaXRlbS5pdGVtX2lkXSA9IG51bTtcbiAgICAgICAgICAgICAgICB2YXIgX3VybCA9ICFpdGVtLmlzX2dpdmVhd2F5ID8gXCIvYXBpL3YxLjEvcmVjb21tZW5kb3JkZXIvY3VzdG9tZXIvXCIgKyB3aW5kb3cuY3VzdG9tZXJfaWQgKyBcIi9jYXJ0XCIgOiBcIi9hcGkvdjEuMS9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIiArIHdpbmRvdy5jdXN0b21lcl9pZCArIFwiL2dpdmVhd2F5XCI7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAncHV0JyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVRvU2VuZCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKCRldmVudCwgaXRlbSl7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgZGF0YVRvU2VuZCA9IHt9O1xuICAgICAgICAgICAgICAgIGRhdGFUb1NlbmRbaXRlbS5pdGVtX2lkXSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpdGVtLmlzX2dpdmVhd2F5KTtcbiAgICAgICAgICAgICAgICB2YXIgX3VybCA9ICFpdGVtLmlzX2dpdmVhd2F5ID8gXCIvYXBpL3YxLjEvcmVjb21tZW5kb3JkZXIvY3VzdG9tZXIvXCIgKyB3aW5kb3cuY3VzdG9tZXJfaWQgKyBcIi9jYXJ0XCIgOiBcIi9hcGkvdjEuMS9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIiArIHdpbmRvdy5jdXN0b21lcl9pZCArIFwiL2dpdmVhd2F5XCI7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAncG9zdCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFUb1NlbmQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZEFsbFNlbGVjdGVkOiBmdW5jdGlvbihkaWQpe1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmRlYWxlcnMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWFsZXJzW2ldLmlkICE9PSBkaWQgJiYgZGlkICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IHRoaXMuZGVhbGVyc1tpXS5pdGVtcy5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWFsZXJzW2ldLml0ZW1zW2pdLnNlbGVjdGVkID09PSBmYWxzZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRTZWxlY3RBbGw6IGZ1bmN0aW9uKCRldmVudCwgZGlkKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhVG9TZW5kID0ge307XG4gICAgICAgICAgICAgICAgZGF0YVRvU2VuZC5pdGVtcyA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgaSwgajtcbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCB0aGlzLmRlYWxlcnMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWFsZXJzW2ldLmlkICE9PSBkaWQgJiYgZGlkICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGogPSAwOyBqIDwgdGhpcy5kZWFsZXJzW2ldLml0ZW1zLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlYWxlcnNbaV0uaXRlbXNbal0uc2VsZWN0ZWQgPT09IGZhbHNlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgdGhpcy5kZWFsZXJzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVhbGVyc1tpXS5pZCAhPT0gZGlkICYmIGRpZCAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGZvcihqID0gMDsgaiA8IHRoaXMuZGVhbGVyc1tpXS5pdGVtcy5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWFsZXJzW2ldLml0ZW1zW2pdLnNlbGVjdGVkID09PSBjdXJyZW50KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVG9TZW5kLml0ZW1zLnB1c2godGhpcy5kZWFsZXJzW2ldLml0ZW1zW2pdLml0ZW1faWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGF0Y2gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhVG9TZW5kLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmluaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogZnVuY3Rpb24oJGV2ZW50LCBpdGVtX2lkKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhVG9TZW5kID0ge307XG4gICAgICAgICAgICAgICAgZGF0YVRvU2VuZC5pdGVtcyA9IFtpdGVtX2lkXTtcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3BhdGNoJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVRvU2VuZCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZW5kQ2hlY2tlZDogZnVuY3Rpb24oaW5pdGlhbF9wcmljZSwgYW1vdW50KXtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBzZW5kX25vOiBpbml0aWFsX3ByaWNlID4gYW1vdW50LFxuICAgICAgICAgICAgICAgICAgICBzZW5kX2NoZWNrZWQ6IGluaXRpYWxfcHJpY2UgPD0gYW1vdW50XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaHJlZjogZnVuY3Rpb24oZGlkKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCIvcmVjb21tZW5kb3JkZXIvZGVhbGVyL1wiICsgZGlkICsgXCIvY3VzdG9tZXIvXCIgKyB3aW5kb3cuY3VzdG9tZXJfaWQgK1wiL2FkZC1pdGVtXCI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29uZmlybU9yZGVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVhbGVycy5sZW5ndGggPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAvLyBhbGVydChcIuaXoOWVhuWTgVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihfdGhpcy5zdW0gPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAvLyAkKCcjcGxhY2VvcmRlcicpLmNzcygnYmFja2dyb3VuZCcsJyNkYmRiZGInKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5kZWFsZXJzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5kZWFsZXJzW2ldLmFtb3VudCA8IHRoaXMuZGVhbGVyc1tpXS5pbml0aWFsX3ByaWNlICYmIHRoaXMuZGVhbGVyc1tpXS5hbW91bnQhPT0wKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwi5ZyoXCIgKyB0aGlzLmRlYWxlcnNbaV0ubmFtZSArIFwi55qE6K6i5Y2V5pyq6L6+5Yiw6LW36YCB6YeR6aKdIVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5fb2ZfZGF5ID0gZC5nZXRNaW51dGVzKCkgKyBkLmdldEhvdXJzKCkgKiA2MDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZyb20gPSB0aGlzLmRlYWxlcnNbaV0uYnVzX2hyX2Zyb207XG4gICAgICAgICAgICAgICAgICAgIHZhciB0byA9IHRoaXMuZGVhbGVyc1tpXS5idXNfaHJfdG87XG4gICAgICAgICAgICAgICAgICAgIGlmKGZyb20gIT09IG51bGwgJiYgdG8gIT09IG51bGwgJiYgdGhpcy5kZWFsZXJzW2ldLmFtb3VudCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZyb20gPCB0byAmJiAobWluX29mX2RheSA8IGZyb20gfHwgbWluX29mX2RheSA+IHRvKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwi5q+P5pelXCIgKyBpbnRQYWQoTWF0aC5mbG9vcih0byAvIDYwKSwgMikgKyBcIjpcIiArIGludFBhZCh0byAlIDYwLCAyKSArIFwiIH4g5qyh5pelXCIgKyBpbnRQYWQoTWF0aC5mbG9vcihmcm9tIC8gNjApLCAyKSArIFwiOlwiICsgaW50UGFkKGZyb20gJSA2MCwgMikgKyB0aGlzLmRlYWxlcnNbaV0ubmFtZSArIFwi5LiL5Y2V57O757uf5Y2H57qn77yMIOS4jeiDveaPkOS+m+e9kei0reS4i+WNleacjeWKoe+8jOaVrOivt+iwheinoyBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmcm9tID4gdG8gJiYgKG1pbl9vZl9kYXk+IHRvICYmIG1pbl9vZl9kYXkgPCBmcm9tKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCLmr4/ml6VcIiArIGludFBhZChNYXRoLmZsb29yKHRvIC8gNjApLCAyKSArIFwiOlwiICsgaW50UGFkKHRvICUgNjAsIDIpICsgXCIgfiBcIiArIGludFBhZChNYXRoLmZsb29yKGZyb20gLyA2MCksIDIpICsgXCI6XCIgKyBpbnRQYWQoZnJvbSAlIDYwLCAyKSArIHRoaXMuZGVhbGVyc1tpXS5uYW1lICsgXCLkuIvljZXns7vnu5/ljYfnuqfvvIwg5LiN6IO95o+Q5L6b572R6LSt5LiL5Y2V5pyN5Yqh77yM5pWs6K+36LCF6KejIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwaS92MS4xL3JlY29tbWVuZG9yZGVyL2N1c3RvbWVyLycgKyB3aW5kb3cuY3VzdG9tZXJfaWQgKyAnL2NoZWNrLWNhcnQnLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5pdGVtcy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnN1ZmZpY2llbnRfaXRlbXMgPSBkYXRhLml0ZW1zO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5kZWwtdW5kZXJzdG9jay1tb2RlbCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdmb290ZXInKS5hZGRDbGFzcygnZ3MtYmx1cicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsZXJ0KFwi6YOo5YiG5ZWG5ZOB5pqC5pe257y66LSn77yM6K+35L+u5pS55pWw6YeP5ZCO5YaN6L+b6KGM5LiL5Y2V44CCXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIiArIHdpbmRvdy5jdXN0b21lcl9pZCArIFwiL2NvbmZpcm0tb3JkZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdpdmVhd2F5SWNvblNyYzogZnVuY3Rpb24ocHJpY2Upe1xuICAgICAgICAgICAgICAgIHJldHVybiBcIi9zdGF0aWMvaW1hZ2VzL3JlY29tbWVuZG9yZGVyL2Z1bGxfXCIgKyBOdW1iZXIocHJpY2UpLnRvRml4ZWQoMCkgKyBcIi5wbmdcIjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9zZURlbGV0ZUluc0l0ZW1zOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQoJ2Zvb3RlcicpLnJlbW92ZUNsYXNzKCdncy1ibHVyJyk7XG4gICAgICAgICAgICAgICAgJCgnLmRlbC11bmRlcnN0b2NrLW1vZGVsJykuaGlkZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFyVW5kZXJzdG9jazogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICQoJ2Zvb3RlcicpLnJlbW92ZUNsYXNzKCdncy1ibHVyJyk7XG4gICAgICAgICAgICAgICAgJCgnLmRlbC11bmRlcnN0b2NrLW1vZGVsJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhVG9TZW5kID0geydpdGVtcyc6IFtdfTtcbiAgICAgICAgICAgICAgICB2YXIgaSwgajtcbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCB0aGlzLmluc3VmZmljaWVudF9pdGVtcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIGZvcihqID0gMDsgaiA8IHRoaXMuaW5zdWZmaWNpZW50X2l0ZW1zW2ldLml0ZW1zLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUb1NlbmQuaXRlbXMucHVzaCh0aGlzLmluc3VmZmljaWVudF9pdGVtc1tpXS5pdGVtc1tqXS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhVG9TZW5kLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy51bmRlcnN0b2NrLW1vZGVsJykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudW5kZXJzdG9jay1tb2RlbCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRQcm9kdWN0OmZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIiArIHdpbmRvdy5jdXN0b21lcl9pZCArIFwiL2RlYWxlci1saXN0XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAgICAgdmFyIGNoYW5nZXByaWNlID0gbmV3IFZ1ZSh7XG4gICAgICAgIGVsOiAnI2NoYW5nZV9wcmljZScsXG4gICAgICAgIGRhdGE6e1xuICAgICAgICAgICAgaXRlbXM6e30sXG4gICAgICAgICAgICBwcmljZXM6W10sXG4gICAgICAgICAgICB2YWw6XCJcIixcbiAgICAgICAgICAgIGlkOlwiXCIsXG4gICAgICAgICAgICBwcmljZV9pZDowLFxuICAgICAgICAgICAgdGltZU91dEV2ZW50OjAsXG4gICAgICAgICAgICAvLyDkv67mlLnku7fmoLzpga7nvanlsYJcbiAgICAgICAgICAgIGNoYW5ncHJpY2U6ZmFsc2UsXG4gICAgICAgICAgICAvLyDliKDpmaTmjInpkq5cbiAgICAgICAgICAgIGNsb3NlOmZhbHNlLFxuICAgICAgICAgICAgLy8g5Y6f5Lu3XG4gICAgICAgICAgICBvcmlnaW5hbGFjdGl2ZTpmYWxzZSxcbiAgICAgICAgICAgIC8v5Lu35qC85bGV56S6XG4gICAgICAgICAgICBoYXZlcHJpY2U6ZmFsc2VcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBtZXRob2RzOiB7XG4gICAgICAgICAgICAgYWRkcHJpY2U6ZnVuY3Rpb24ob3JpZ3ByaWNlKXtcbiAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfdGhpcy5pdGVtcy5pdGVtX3ByaWNlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMudmFsID09IF90aGlzLml0ZW1zLml0ZW1fcHJpY2VzW2ldLnByaWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAkKFwiLmNoYW5nZV9wcmljZV9ib2R5byBzcGFuXCIpLmNzcyhcImRpc3BsYXlcIixcImJsb2NrXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYXZlcHJpY2U9dHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICQoXCIuY2hhbmdlX3ByaWNlX2JvZHlvIHNwYW5cIikuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGF2ZXByaWNlPWZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbCE9PScnICYmIF90aGlzLmhhdmVwcmljZT09PWZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEuMi9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIit3aW5kb3cuY3VzdG9tZXJfaWQrXCIvaXRlbS1wcmljZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwdXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpdGVtX2lkXCI6X3RoaXMuaXRlbXMuaXRlbV9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcmljZVwiOihOdW1iZXIoX3RoaXMudmFsKS1OdW1iZXIob3JpZ3ByaWNlKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZC5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kLmNoYW5nZShfdGhpcy5pdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWw9XCJcIjtcbiAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIFxuXG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjaGFuZ2VjbG9zZTpmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2hhbmdwcmljZT1mYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpcy5oYXZlcHJpY2U9ZmFsc2U7XG4gICAgICAgICAgICAgICAgY2hhbmdlcHJpY2UuY2xvc2U9ZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzY2xvc2U6ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICBfdGhpcy5jbG9zZT1mYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWxwcmljZTpmdW5jdGlvbihpKXtcbiAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgdmFyIGlkID0gaTtcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS4yL3JlY29tbWVuZG9yZGVyL2N1c3RvbWVyL1wiK3dpbmRvdy5jdXN0b21lcl9pZCtcIi9pdGVtLXByaWNlXCIsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInByaWNlX2lkXCI6aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNhcnRfaXRlbV9pZFwiOl90aGlzLmlkXG5cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBiaW5kLmluaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmQuY2hhbmdlKF90aGlzLml0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pOyAgXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb2twcmljZTpmdW5jdGlvbihlLGlkKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmKF90aGlzLmNsb3NlPT09ZmFsc2Upe1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcmljZV9pZD1pZDtcbiAgICAgICAgICAgICAgICAgICAgJChlLmN1cnJlbnRUYXJnZXQpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKGUuY3VycmVudFRhcmdldCkuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gJChcIi5jaGFuZ2VfcHJpY2Vfb3duXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5vcmlnaW5hbGFjdGl2ZT1mYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGF2ZXByaWNlPWZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBndG91Y2hzdGFydDpmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgX3RoaXMudGltZU91dEV2ZW50ID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlPXRydWU7XG4gICAgICAgICAgICAgICAgX3RoaXMucHJpY2VfaWQ9MDtcbiAgICAgICAgICAgICAgICAvLyAkKFwiLmNoYW5nZV9wcmljZV9wcmljZV9jbG9zZVwiKS5jc3MoXCJkaXNwbGF5XCIsXCJibG9ja1wiKVxuICAgICAgICAgICAgICAgfSw1MDApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yaWdpbmFscHJpY2U6ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIF90aGlzLnByaWNlX2lkPTA7XG4gICAgICAgICAgICAgICAgLy8gJChcIi5jaGFuZ2VfcHJpY2Vfb3duXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICBfdGhpcy5vcmlnaW5hbGFjdGl2ZT10cnVlO1xuICAgICAgICAgICAgICAgICQoXCIuY2hhbmdlX3ByaWNlX3ByaWNlbyBsaVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBndG91Y2hlbmQ6ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChfdGhpcy50aW1lT3V0RXZlbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbW1pdDpmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKCBfdGhpcy5wcmljZV9pZD09PTApIHtcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogXCIvYXBpL3YxLjIvcmVjb21tZW5kb3JkZXIvY3VzdG9tZXIvXCIrd2luZG93LmN1c3RvbWVyX2lkK1wiL2l0ZW0tcHJpY2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwb3N0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9yaWdpbmFsX3ByaWNlXCI6MSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNhcnRfaXRlbV9pZFwiOl90aGlzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZC5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZC5jaGFuZ2UoX3RoaXMuaXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICQoXCIjY2hhbmdlX3ByaWNlXCIpLmNzcygnZGlzcGxheScsJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jaGFuZ3ByaWNlPWZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhdmVwcmljZT1mYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsPVwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEuMi9yZWNvbW1lbmRvcmRlci9jdXN0b21lci9cIit3aW5kb3cuY3VzdG9tZXJfaWQrXCIvaXRlbS1wcmljZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJpY2VfaWRcIjpfdGhpcy5wcmljZV9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNhcnRfaXRlbV9pZFwiOl90aGlzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZC5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZC5jaGFuZ2UoX3RoaXMuaXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICQoXCIjY2hhbmdlX3ByaWNlXCIpLmNzcygnZGlzcGxheScsJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jaGFuZ3ByaWNlPWZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhdmVwcmljZT1mYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsPVwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbW91bnRlZDpmdW5jdGlvbigpe1xuICAgICAgICB9XG4gICAgfSk7XG5iaW5kLmluaXQoKTtcbn0pKHdpbmRvdy5jbUFwcCA9IHdpbmRvdy5jbUFwcCB8fCB7fSk7XG4iXX0=
